+function(a){var b;a.captcha=function(j,i,d,h,f,c){var e;if(typeof j==="object"){e=j}else{if(typeof i==="function"){c=arguments[4];f=arguments[3];h=arguments[2];d=arguments[1];i=undefined}e={text:j,title:i,captcha:f,input:c,onOK:d,onCancel:h,empty:false}}var g=a.modal({text:'<p class="weui-prompt-text">'+(e.text||"")+"</p>"+'<img class="weui-vcode-img" style="margin-top:10px;width:80%;margin-left:0;" src="'+(e.captcha||"")+'">'+'<input type="text" class="weui-input weui-prompt-input" id="weui-prompt-captcha" placeholder="'+(e.input||"")+'" />',title:e.title,autoClose:false,buttons:[{text:b.buttonCancel,className:"default",onClick:function(){a.closeModal();e.onCancel&&e.onCancel.call(g)}},{text:b.buttonOK,className:"primary",onClick:function(){var k=a("#weui-prompt-input").val();if(!e.empty&&(k===""||k===null)){g.find(".weui-prompt-input").focus()[0].select();return false}if(e.onOK){e.onOK.call(g,k)}else{a.closeModal()}}}]},function(){this.find(".weui-prompt-input").focus()[0].select();var k=a(".weui-vcode-img").attr("src");a(".weui-vcode-img").bind("click",function(){a(this).attr("src",k+"#"+Math.random())})});return g};b=a.modal.prototype.defaults={title:"提示",text:undefined,buttonOK:"确定",buttonCancel:"取消",buttons:[{text:"确定",className:"primary"}],autoClose:true}}($);+function(b){var a=function(d,e){if(e.callback){var g=e.callback;delete e.callback}if(e.loadText){var c=e.loadText;delete e.loadText}else{var c="网络请求中"}a.defaults={tiptype:function(i,h){if(h.type==3){b.toast(i,"text")}},showAllError:false,postonce:true,tipSweep:true,ajaxpost:{timeout:5000,success:function(i,j){b.hideLoading();var h=setTimeout(function(){g&&g(i);clearTimeout(h)},200)},error:function(){b.hideLoading();var h=setTimeout(function(){b.toast("网络请求超时","text");clearTimeout(h)},200)}},beforeSubmit:function(h){b.showLoading(c)}};var e=b.extend({},a.defaults,e);var f=d.Validform(e);return f};b.fn.validator=function(c){return new a(this,c)}}($);+function(b){var a=function(c,f,g,e,d){b.showLoading("网络请求中");b.ajax({url:c,data:f,type:d||"GET",timeout:e||5000,success:function(i){b.hideLoading();var h=setTimeout(function(){g(i);clearTimeout(h)},200)},error:function(){b.hideLoading();var h=setTimeout(function(){b.toast("网络请求超时","text");clearTimeout(h)},200)}})};b.ajaxPost=function(c,e,f,d){return new a(c,e,f,d,"POST")};b.ajaxGet=function(c,e,f,d){return new a(c,e,f,d,"GET")}}($);+function(a){a.prototype.serializeObject=function(){var b,g,d,c,f;b=this.serializeArray();g={};d=g.hasOwnProperty;for(c=0;c<b.length;c++){f=b[c];if(!d.call(g,f.name)){g[f.name]=f.value}}return g}}($);+function($){const UPLOADING=2;const UPLOADSUCC=1;const UPLOADFAIL=0;var uploader=function(ele,settings){this.ele=ele||$("input[type=file]");this.url=settings.url||"/";this.data=settings.data||{};this.allowTypes=settings.allowTypes||["image/jpg","image/jpeg","image/png","image/gif"];this.maxWidth=settings.maxWidth||320;this.maxSize=settings.maxSize||5*1024*1024;this.maxCount=settings.maxCount||5;this.error=settings.error||function(e){};this.success=settings.success||function(e){};this.before=settings.before||function(e){};this.inputName=settings.inputName||"file";this.timeout=10000;this.upToken=settings.upToken;this.init();return this};uploader.prototype.init=function(){$(".weui-progress__inner-bar").css({"width":0});this.before()};uploader.prototype.qiniu=function(base64,success,error,timeout){var _this=this;var pic=base64.substr(base64.indexOf(",")+1,base64.length);var url="http://up-z2.qiniu.com/putb64/-1";var index=setTimeout(function(){error&&error()},timeout);var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){clearTimeout(index);success&&success(xhr.responseText)}else{error&&error()}}};xhr.open("POST",url,true);xhr.setRequestHeader("Content-Type","application/octet-stream");xhr.setRequestHeader("Authorization","UpToken "+_this.upToken);xhr.send(pic)};uploader.prototype.create=function(){var _this=this;_this.ele.on("change",function(event){var files=event.target.files;var _that=$(this);var uploaderContainer=_that.parents(".weui-uploader");var filesContainer=uploaderContainer.find(".weui-uploader__files");var inputContainer=_that.parents(".weui-uploader__input-box");var infoContainer=uploaderContainer.find(".weui-uploader__info");var progressBarContainer=uploaderContainer.find(".weui-progress__inner-bar");var maxCount=parseInt(infoContainer.text().split("/")[1]);if(files.length===0){return}for(var i=0,len=files.length;i<len;i++){var file=files[i];var reader=new FileReader();if(_this.allowTypes.indexOf(file.type)===-1){$.toptip("该类型不允许上传","warning");continue}if(file.size>_this.maxSize){$.toptip("图片太大，不允许上传","warning");continue}if($(".weui_uploader_file").length>=maxCount){$.toptip("最多只能上传"+maxCount+"张图片","warning");return}reader.onload=function(e){var img=new Image();img.onload=function(){var w=Math.min(_this.maxWidth,img.width);var h=img.height*(w/img.width);var canvas=document.createElement("canvas");var ctx=canvas.getContext("2d");
canvas.width=w;canvas.height=h;ctx.drawImage(img,0,0,w,h);var base64=canvas.toDataURL("image/png");inputContainer.hide();var preview=$('<li class="weui-uploader__file weui-uploader__file_status" style="background-image:url('+base64+')"><div class="weui-uploader__file-content">0%</div></li>');filesContainer.append(preview);var num=filesContainer.find(".weui-uploader__file").length;infoContainer.text(num+"/"+maxCount);var progressContainer=preview.find(".weui-uploader__file-content");var progress=0;var uploadStatus=UPLOADING;var width=0;function uploading(){progress+=1;progressContainer.text(progress+"%");width=(num-1)*(100/maxCount)+(100/maxCount)*progress/100;progressBarContainer.css({"width":width+"%"});if(progress<100&&uploadStatus===UPLOADING){setTimeout(uploading,_this.timeout/100)}else{if(uploadStatus===UPLOADFAIL){$.toptip("上传失败，稍后重试","warning");preview.find(".weui-uploader__file-content").html('<i class="weui-icon-warn"></i>')}else{if(progress>=100&&uploadStatus===UPLOADSUCC){$.toptip("上传成功","success");preview.removeClass("weui-uploader__file_status").find(".weui-uploader__file-content").remove()}else{setTimeout(uploading,_this.timeout/100)}}}}_this.data[_this.inputName]=base64;console.log(_this.timeout);_this.qiniu(base64,function(res){res=eval("("+res+")");uploadStatus=UPLOADSUCC;_this.success(_that,res)},function(){uploadStatus=UPLOADFAIL},_this.timeout);setTimeout(uploading,_this.timeout/100)};img.src=e.target.result};reader.readAsDataURL(file)}})};$.fn.uploader=function(settings){return(new uploader(this,settings)).create()}}($);